/
â”œâ”€ index.html
â””â”€ api/
   â”œâ”€ check-access.js
   â”œâ”€ create-checkout.js
   â””â”€ stripe-webhook.js
<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <title>NovaMark AI â€” Your 24/7 Marketing Co-Pilot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="AI marketing advisor Ï€Î¿Ï… Ï†Ï„Î¹Î¬Ï‡Î½ÎµÎ¹ ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ­Ï‚, ad copy, budgets ÎºÎ±Î¹ growth plans ÏƒÎµ Î»ÎµÏ€Ï„Î¬." />
  <link rel="icon" href="favicon.ico" />
  <style>
    :root{
      --bg:#070b14; --panel:#0d1428; --soft:#111a33; --line:#1e2a4a;
      --txt:#eef2ff; --muted:#a5b4d6; --brand:#6c7cff; --brand-2:#22d3ee; --ok:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1200px 600px at 20% -10%, #13214a33, transparent), var(--bg); color:var(--txt); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* Nav */
    nav{position:sticky;top:0;z-index:50;background:linear-gradient(180deg,#070b1499,#070b1400);backdrop-filter:blur(8px);border-bottom:1px solid #ffffff12}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:18px}
    .brand .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 0 40px #6c7cff55}
    .nav-cta a{display:inline-block;padding:10px 14px;border:1px solid var(--line);border-radius:12px;background:linear-gradient(180deg,#0f1832,#0a1226);font-weight:600}
    .nav-cta a.primary{border-color:#6c7cff55;background:linear-gradient(180deg,#5865f2,#4553e2);box-shadow:0 8px 24px #5865f244}

    /* Hero */
    .hero{padding:76px 0 40px}
    .grid-2{display:grid;grid-template-columns:1.2fr 1fr;gap:32px}
    .badge{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid #6c7cff44;background:#0b1220aa;font-size:12px}
    .h1{font-size:40px;line-height:1.1;margin:14px 0 10px;font-weight:900;letter-spacing:-.02em}
    .lead{font-size:16px;color:var(--muted);max-width:640px}
    .hero-ctas{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#121a36,#0b1226);font-weight:700;cursor:pointer}
    .btn.primary{border-color:#6c7cff77;background:linear-gradient(180deg,#6c7cff,#5563f2);box-shadow:0 10px 30px #6c7cff33}
    .meta{font-size:12px;color:var(--muted);margin-top:10px}
    .panel{background:linear-gradient(180deg,#0d1428,#0a1122);border:1px solid var(--line);border-radius:16px;padding:16px}
    .hero-card{min-height:280px;display:grid;gap:10px}
    .pill{font-size:12px;border:1px solid #2a3866;border-radius:999px;padding:6px 10px;display:inline-flex;gap:8px;align-items:center}
    .list{display:grid;gap:10px;font-size:14px}
    .li{display:flex;gap:10px;align-items:flex-start}
    .li .dot{width:8px;height:8px;border-radius:50%;background:var(--brand-2);margin-top:6px;box-shadow:0 0 12px #22d3eeaa}

    /* Sections */
    section{padding:54px 0;border-top:1px solid #ffffff0f}
    h2{font-size:28px;margin:0 0 8px}
    .sub{color:var(--muted);max-width:720px;margin-bottom:22px}
    .features{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:linear-gradient(180deg,#0e1530,#0b1326);border:1px solid var(--line);border-radius:16px;padding:18px}
    .pricing{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .price-card{background:linear-gradient(180deg,#0e1530,#0b1326);border:1px solid var(--line);border-radius:18px;padding:20px;position:relative}
    .price{font-size:36px;font-weight:900;margin:6px 0}
    .tag{position:absolute;top:12px;right:12px;font-size:12px;border:1px solid #6c7cff66;border-radius:999px;padding:4px 8px;background:#111a33}
    .ul{display:grid;gap:10px;margin:12px 0}
    .ul .ok{color:var(--ok)} .ul .no{color:#ef4444}
    .faq{display:grid;gap:10px}
    details{background:#0c142b;border:1px solid var(--line);border-radius:12px;padding:14px}
    summary{cursor:pointer;font-weight:700}

    /* Footer */
    footer{padding:24px 0;color:var(--muted)}
    .foot{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}

    /* Bubble + Modal */
    #aiBubble{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#5865f2,#4654e2);color:#fff;display:flex;align-items:center;justify-content:center;font:600 18px/1 system-ui;border:none;cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.35);z-index:9999}
    #aiBubble:focus{outline:2px solid #fff8;outline-offset:2px}
    #aiModal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:9998}
    #aiDialog{width:min(960px,96vw);height:min(82vh,920px);background:#0b1220;border-radius:16px;overflow:hidden;border:1px solid #1e2a4a;display:flex;flex-direction:column}
    #aiDialog header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:#11192e;color:#f4f6fb}
    #aiClose{background:transparent;border:0;color:#fff;font-size:22px;cursor:pointer}
    .ai-body{flex:1;min-height:360px;position:relative}
    .loading{display:flex;align-items:center;justify-content:center;height:100%;color:#a5b4d6}

    /* Responsive */
    @media (max-width:1000px){
      .grid-2{grid-template-columns:1fr}
      .features{grid-template-columns:1fr 1fr}
      .pricing{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <nav>
    <div class="container nav-inner">
      <div class="brand"><div class="logo"></div> NovaMark AI</div>
      <div class="nav-cta">
        <a href="#pricing">Pricing</a>
        <a class="primary" href="#" onclick="startTrial()" rel="nofollow">Try Free</a>
      </div>
    </div>
  </nav>

  <header class="hero">
    <div class="container grid-2">
      <div>
        <div class="badge">âš¡ Launch campaigns 10Ã— faster</div>
        <h1 class="h1">Your 24/7 AI Marketing Co-Pilot</h1>
        <p class="lead">Î Î¬ÏÎµ ÏƒÏ„ÏÎ±Ï„Î·Î³Î¹ÎºÎ®, ad copy, budget split, emails ÎºÎ±Î¹ growth plan â€” Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± ÏƒÏ„Î·Î½ ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ® ÏƒÎ¿Ï… ÏƒÎµ Î»Î¯Î³Î± Î»ÎµÏ€Ï„Î¬.</p>
        <div class="hero-ctas">
          <a class="btn primary" href="#" onclick="startTrial()" rel="nofollow">Start Free (7 days)</a>
          <a class="btn" href="#how">See how it works</a>
        </div>
        <div class="meta">Card required for free trial Â· Cancel anytime</div>
      </div>
      <div class="panel hero-card">
        <div class="pill">âœ… Strategy builder</div>
        <div class="pill">ğŸ’¬ Ad copy + hooks</div>
        <div class="pill">ğŸ“… 7-day content plan</div>
        <div class="list">
          <div class="li"><div class="dot"></div>Playbooks Î³Î¹Î± Meta/Google/TikTok.</div>
          <div class="li"><div class="dot"></div>3Ã— ad variants Î¼Îµ CTAs.</div>
          <div class="li"><div class="dot"></div>Budget split, KPIs, next actions.</div>
        </div>
      </div>
    </div>
  </header>

  <section id="features">
    <div class="container">
      <h2>Why teams use NovaMark</h2>
      <p class="sub">Î‘Ï€ÏŒ solo founders Î­Ï‰Ï‚ enterprise â€” ÏƒÏ„ÎµÎ¯Î»Îµ ÎºÎ±Î¼Ï€Î¬Î½Î¹ÎµÏ‚ Ï€Î¹Î¿ Î³ÏÎ®Î³Î¿ÏÎ± Î¼Îµ AI ÎºÎ±Î¸Î¿Î´Î®Î³Î·ÏƒÎ· Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎºÎ±Î¹ Î¼ÎµÏ„ÏÎ®ÏƒÎ¹Î¼Î·.</p>
      <div class="features">
        <div class="card"><h3>Actionable strategy</h3><p>Î’Î®Î¼Î±Ï„Î± Î¼Îµ timing, ÎºÎ±Î½Î¬Î»Î¹Î± ÎºÎ±Î¹ KPIs.</p></div>
        <div class="card"><h3>Ad copy Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹</h3><p>Headlines, bodies, hooks & CTAs Î³Î¹Î± Meta/Google/TikTok.</p></div>
        <div class="card"><h3>Content calendar</h3><p>7-day Ï€Î»Î¬Î½Î¿ Î¼Îµ captions & prompts.</p></div>
      </div>
    </div>
  </section>

  <section id="how">
    <div class="container">
      <h2>How it works</h2>
      <p class="sub">Î¤ÏÎ¯Î± Î²Î®Î¼Î±Ï„Î± Î±Ï€ÏŒ Î¹Î´Î­Î± ÏƒÎµ launch.</p>
      <div class="features" style="grid-template-columns:repeat(4,1fr)">
        <div class="card"><b>1. Brief</b><br/>Î ÎµÏ‚ Ï€ÏÎ¿ÏŠÏŒÎ½, ÎºÎ¿Î¹Î½ÏŒ, ÏƒÏ„ÏŒÏ‡Î¿.</div>
        <div class="card"><b>2. Plan</b><br/>Î£Ï„ÏÎ±Ï„Î·Î³Î¹ÎºÎ®, messaging, Î¹Î´Î­ÎµÏ‚ ads.</div>
        <div class="card"><b>3. Build</b><br/>Copy, emails, 7-day calendar.</div>
        <div class="card"><b>4. Iterate</b><br/>Î’ÎµÎ»Ï„Î¯Ï‰ÏƒÎ· Î¼Îµ data & A/B.</div>
      </div>
    </div>
  </section>

  <section id="pricing">
    <div class="container">
      <h2>Pricing</h2>
      <p class="sub">Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï€Î»Î¬Î½Î¿. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î±Î½Î±Î²Î±Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚/Î±ÎºÏ…ÏÏÏƒÎµÎ¹Ï‚ Î¿Ï€Î¿Ï„ÎµÎ´Î®Ï€Î¿Ï„Îµ.</p>
      <div class="pricing">
        <div class="price-card">
          <span class="tag">Starter</span>
          <div class="price">$9<span style="font-size:14px;color:var(--muted)">/mo</span></div>
          <div class="ul">
            <div class="ok">âœ“ Basic strategy & 3 ad ideas</div>
            <div class="ok">âœ“ 7-day content outline</div>
            <div class="no">â€” No file analysis</div>
          </div>
          <a class="btn primary" href="#" onclick="startCheckout('starter')" rel="nofollow">Choose Starter</a>
        </div>

        <div class="price-card" style="border-color:#6c7cff99;box-shadow:0 10px 40px #6c7cff22">
          <span class="tag">Pro â€¢ Most Popular</span>
          <div class="price">$29<span style="font-size:14px;color:var(--muted)">/mo</span></div>
          <div class="ul">
            <div class="ok">âœ“ Full strategy + KPIs</div>
            <div class="ok">âœ“ 9 ad variants + CTAs</div>
            <div class="ok">âœ“ Exportable 7-day calendar</div>
            <div class="no">â€” No team seats</div>
          </div>
          <a class="btn primary" href="#" onclick="startCheckout('pro')" rel="nofollow">Go Pro</a>
        </div>

        <div class="price-card">
          <span class="tag">Premium</span>
          <div class="price">$79<span style="font-size:14px;color:var(--muted)">/mo</span></div>
          <div class="ul">
            <div class="ok">âœ“ Everything in Pro</div>
            <div class="ok">âœ“ File/CSV analysis</div>
            <div class="ok">âœ“ Priority responses</div>
            <div class="ok">âœ“ 3 team seats</div>
          </div>
          <a class="btn primary" href="#" onclick="startCheckout('premium')" rel="nofollow">Upgrade</a>
        </div>
      </div>
      <div class="panel" style="margin-top:18px">
        <div class="meta">Î— Î´Ï‰ÏÎµÎ¬Î½ Î´Î¿ÎºÎ¹Î¼Î® (7 Î·Î¼Î­ÏÎµÏ‚) Î¶Î·Ï„Î¬ÎµÎ¹ ÎºÎ¬ÏÏ„Î±. Î‘Î½ Î´ÎµÎ½ Î±ÎºÏ…ÏÏÏƒÎµÎ¹Ï‚ ÎµÎ³ÎºÎ±Î¯ÏÏ‰Ï‚, Î±Î½Î±Î²Î±Î¸Î¼Î¯Î¶ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î¿ Pro.</div>
      </div>
    </div>
  </section>

  <section id="faq">
    <div class="container">
      <h2>FAQ</h2>
      <div class="faq">
        <details><summary>Î ÏÏ‚ Î¾ÎµÎºÎ¹Î½Î¬Ï‰;</summary><p>Î Î¬Ï„Î·ÏƒÎµ â€œStart Freeâ€ Î³Î¹Î± 7 Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· (Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ ÎºÎ¬ÏÏ„Î±).</p></details>
        <details><summary>ÎœÏ€Î¿ÏÏ Î½Î± Î±ÎºÏ…ÏÏÏƒÏ‰;</summary><p>ÎÎ±Î¹, Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÏƒÏ„Î¹Î³Î¼Î® Î±Ï€ÏŒ Ï„Î¿ billing portal Ï€ÏÎ¹Î½ Ï„Î· Î»Î®Î¾Î· Ï„Î·Ï‚ Î´Î¿ÎºÎ¹Î¼Î®Ï‚.</p></details>
        <details><summary>Î¤Î¹ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÏ„Î±Î¹;</summary><p>Î£Ï„ÏÎ±Ï„Î·Î³Î¹ÎºÎ­Ï‚, ad copy, 7-day content plan, KPIs. Î£Ï„Î¿ Premium Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÏ„Î±Î¹ ÎºÎ±Î¹ Î±Î½Î¬Î»Ï…ÏƒÎ· Î±ÏÏ‡ÎµÎ¯Ï‰Î½.</p></details>
      </div>
    </div>
  </section>

  <footer>
    <div class="container foot">
      <div>Â© <span id="y"></span> NovaMark AI â€¢ All rights reserved</div>
      <div>
        <a href="#pricing">Pricing</a> â€¢
        <a href="#faq">FAQ</a> â€¢
        <a href="mailto:hello@yourdomain.com">Contact</a>
      </div>
    </div>
  </footer>

  <!-- ğŸ’¬ Floating bubble -->
  <button id="aiBubble" aria-controls="aiModal" aria-expanded="false" aria-label="Open AI helper">ğŸ’¬</button>

  <!-- ğŸªŸ Chat modal -->
  <div id="aiModal" role="dialog" aria-modal="true" aria-labelledby="aiDialogTitle" style="display:none">
    <div id="aiDialog">
      <header>
        <div id="aiDialogTitle">AI Marketing Advisor</div>
        <button id="aiClose" aria-label="Close chat">Ã—</button>
      </header>
      <div id="aiBody" class="ai-body"><div class="loading">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·â€¦</div></div>
    </div>
  </div>

  <script>
    // footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // ===== Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ =====
    const CHAT_BASE_URL = 'https://ai-marketing-chat-git-main-ai-chat-projects-projects.vercel.app/'; // â† Î’Î‘Î›Î• Î¤ÎŸ Î”Î™ÎšÎŸ Î£ÎŸÎ¥ chat URL
    const CHECK_ACCESS_ENDPOINT = '/api/check-access';
    const PRICE_IDS = {
      starter:  'STARTER_PRICE_ID',  // â† Î²Î¬Î»Îµ Ï„Î¿ Stripe price id
      pro:      'PRO_PRICE_ID',      // â† Î²Î¬Î»Îµ Ï„Î¿ Stripe price id
      premium:  'PREMIUM_PRICE_ID'   // â† Î²Î¬Î»Îµ Ï„Î¿ Stripe price id
    };

    // ===== Checkout actions =====
    async function startCheckout(plan){
      try{
        const r = await fetch('/api/create-checkout', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ priceId: PRICE_IDS[plan], plan })
        });
        const { url, error } = await r.json();
        if (url) { location.href = url; }
        else { alert('Checkout error: ' + (error || 'unknown')); }
      }catch(e){ alert('Network error'); }
    }
    function startTrial(){ startCheckout('pro'); } // 7-day trial ÏƒÏ„Î¿ Pro (ÏƒÏ„Î¿ server Î¿ÏÎ¯Î¶Î¿Ï…Î¼Îµ trial)

    // ===== AI bubble / modal =====
    (function(){
      const bubble = document.getElementById('aiBubble');
      const modal  = document.getElementById('aiModal');
      const close  = document.getElementById('aiClose');

      function getPageContext(){
        const title = document.title || '';
        const href  = location.href;
        const meta  = document.querySelector('meta[name="description"]');
        const description = meta ? meta.content : '';
        const selection = (window.getSelection && String(window.getSelection())) || '';
        const h1 = (document.querySelector('h1') && document.querySelector('h1').innerText) || '';
        return { title, href, description, selection, h1, ts: Date.now() };
      }
      function encodeContext(ctx){
        try { return btoa(unescape(encodeURIComponent(JSON.stringify(ctx)))); }
        catch { return ''; }
      }

      async function userHasAccess(){
        try{
          const resp = await fetch(CHECK_ACCESS_ENDPOINT, { credentials: 'include' });
          if(!resp.ok) return false;
          const data = await resp.json();
          return !!data.hasAccess;
        }catch{ return false; }
      }

      function renderIframe(container, src){
        const iframe = document.createElement('iframe');
        iframe.id = 'aiFrame';
        iframe.src = src;
        iframe.loading = 'lazy';
        iframe.referrerPolicy = 'no-referrer';
        iframe.title = 'AI Marketing Chat';
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        iframe.style.border = '0';
        iframe.setAttribute('allow', 'clipboard-write; microphone; camera');
        iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-popups allow-forms');
        container.innerHTML = '';
        container.appendChild(iframe);
      }
      function renderPaywall(container){
        container.innerHTML = `
          <div class="panel" style="height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:12px">
            <h3 style="margin:0">Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Premium</h3>
            <p style="color:#a5b4d6;margin:0">Î“Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Î½ AI Î²Î¿Î·Î¸ÏŒ, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÎµÎ½ÎµÏÎ³Î® ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®.</p>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <a class="btn primary" href="#pricing">Î”ÎµÏ‚ Ï„Î± Ï€Î»Î¬Î½Î±</a>
              <button class="btn" onclick="location.hash='#pricing'">ÎˆÏ‡Ï‰ Î®Î´Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·</button>
            </div>
          </div>
        `;
      }

      async function initChatBody(){
        const container = document.getElementById('aiBody');
        container.innerHTML = '<div class="loading">ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚â€¦</div>';
        const has = await userHasAccess();
        if(!has){ renderPaywall(container); return; }
        const ctx = getPageContext();
        const encoded = encodeContext(ctx);
        const glue = CHAT_BASE_URL.includes('?') ? '&' : '?';
        const src = `${CHAT_BASE_URL}${glue}context=${encoded}`;
        renderIframe(container, src);
      }

      function openChat(){
        modal.style.display = 'flex';
        bubble.setAttribute('aria-expanded','true');
        close.focus({preventScroll:true});
        initChatBody();
      }
      function closeChat(){
        modal.style.display = 'none';
        bubble.setAttribute('aria-expanded','false');
        bubble.focus({preventScroll:true});
      }

      bubble.addEventListener('click', openChat);
      close.addEventListener('click', closeChat);
      modal.addEventListener('click', e => { if (e.target === modal) closeChat(); });
      window.addEventListener('keydown', e => { if (e.key === 'Escape' && modal.style.display === 'flex') closeChat(); });
    })();
  </script>

  <noscript>Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ JavaScript Î³Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Î½ AI Î²Î¿Î·Î¸ÏŒ.</noscript>
</body>
</html>
// /api/check-access.js
export default async function handler(req, res) {
  // TODO: Î’Î¬Î»Îµ Ï„Î¿Î½ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Î­Î»ÎµÎ³Ï‡Î¿ (cookie/session/DB)
  // Î ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½: Ï€Î¬Î½Ï„Î± true Î³Î¹Î± Î½Î± Î´Î¿Ï…Î»Î­ÏˆÎµÎ¹ Ï„Î¿ iframe
  res.status(200).json({ hasAccess: true });
}
// /api/create-checkout.js
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

const PRICE_IDS = {
  starter:  'STARTER_PRICE_ID',   // Î²Î¬Î»Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…
  pro:      'PRO_PRICE_ID',       // Î²Î¬Î»Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…
  premium:  'PREMIUM_PRICE_ID'    // Î²Î¬Î»Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…
};

export default async function handler(req, res) {
  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' });

  try {
    const { plan } = req.body;
    const priceId = PRICE_IDS[plan];
    if (!priceId) return res.status(400).json({ error: 'Unknown plan' });

    const session = await stripe.checkout.sessions.create({
      mode: 'subscription',
      line_items: [{ price: priceId, quantity: 1 }],
      success_url: `${process.env.NEXT_PUBLIC_SITE_URL}/#success`,
      cancel_url: `${process.env.NEXT_PUBLIC_SITE_URL}/#pricing`,
      subscription_data: {
        trial_period_days: plan === 'pro' ? 7 : undefined // trial ÏƒÏ„Î¿ Pro
      },
      allow_promotion_codes: true
    });

    res.status(200).json({ url: session.url });
  } catch (e) {
    res.status(500).json({ error: 'Stripe error' });
  }
}
// /api/stripe-webhook.js
import Stripe from 'stripe';
import { buffer } from 'micro';

export const config = { api: { bodyParser: false } };

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);

export default async function handler(req, res) {
  const sig = req.headers['stripe-signature'];

  let event;
  try {
    const buf = await buffer(req);
    event = stripe.webhooks.constructEvent(buf, sig, process.env.STRIPE_WEBHOOK_SECRET);
  } catch (err) {
    return res.status(400).send(`Webhook Error: ${err.message}`);
  }

  // TODO: Î£Ï„Î¿ checkout.session.completed / subscription.updated
  // Î³ÏÎ¬ÏˆÎµ ÏƒÎµ DB ÏŒÏ„Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î­Ï‡ÎµÎ¹ ÎµÎ½ÎµÏÎ³Î® ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®.
  // Î•Î´Ï ÎºÏÎ±Ï„Î¬Î¼Îµ Î¼ÏŒÎ½Î¿ log Î³Î¹Î± Î¾ÎµÎºÎ¯Î½Î·Î¼Î±.
  console.log('Stripe event:', event.type);

  res.json({ received: true });
}
