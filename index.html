<!-- 💬 Floating chat bubble -->
<button id="aiBubble" aria-controls="aiModal" aria-expanded="false" aria-label="Open AI chat">💬</button>

<!-- 🪟 Chat modal -->
<div id="aiModal" role="dialog" aria-modal="true" aria-labelledby="aiDialogTitle" style="display:none">
  <div id="aiDialog">
    <header>
      <div id="aiDialogTitle">AI Marketing Advisor</div>
      <button id="aiClose" aria-label="Close chat">×</button>
    </header>

    <!-- ✅ Σωστό iframe με το domain σου -->
    <iframe
      id="aiFrame"
      src="https://ai-marketing-chat-git-main-ai-chat-projects-projects.vercel.app/"
      loading="lazy"
      referrerpolicy="no-referrer"
      title="AI Marketing Chat"
      style="width:100%;height:calc(100% - 48px);border:0;display:block"
      allow="clipboard-write; microphone; camera"
      sandbox="allow-scripts allow-same-origin allow-popups allow-forms">
    </iframe>
  </div>
</div>

<script>
  (function(){
    const bubble = document.getElementById('aiBubble');
    const modal  = document.getElementById('aiModal');
    const dialog = document.getElementById('aiDialog');
    const close  = document.getElementById('aiClose');

    function openChat(){
      modal.style.display = 'flex';
      bubble.setAttribute('aria-expanded','true');
      // focus για προσβασιμότητα
      close.focus({preventScroll:true});
      // προαιρετικά: αλλάζεις src μέσω query (?chat=...)
      const q = new URLSearchParams(location.search).get('chat');
      if (q) document.getElementById('aiFrame').src = q;
    }
    function closeChat(){
      modal.style.display = 'none';
      bubble.setAttribute('aria-expanded','false');
      bubble.focus({preventScroll:true});
    }

    bubble.addEventListener('click', openChat);
    close.addEventListener('click', closeChat);
    modal.addEventListener('click', e => { if (e.target === modal) closeChat(); });
    // Esc για κλείσιμο
    window.addEventListener('keydown', e => { if (e.key === 'Escape' && modal.style.display === 'flex') closeChat(); });
  })();
</script>

<style>
  /* Bubble */
  #aiBubble{
    position:fixed; right:20px; bottom:20px;
    width:56px; height:56px; border-radius:50%;
    background:linear-gradient(135deg,#5865f2,#4654e2);
    color:#fff; font:600 18px/1 system-ui; border:0; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    box-shadow:0 10px 20px rgba(0,0,0,.35); z-index:9999;
  }
  #aiBubble:focus{ outline:2px solid #fff8; outline-offset:2px; }

  /* Modal */
  #aiModal{
    position:fixed; inset:0; background:rgba(0,0,0,.5);
    align-items:center; justify-content:center; z-index:9998;
  }
  #aiDialog{
    width:min(960px,96vw); height:min(82vh,920px);
    background:#0b1220; border-radius:16px; overflow:hidden;
    border:1px solid #1e2a4a; display:flex; flex-direction:column;
  }
  #aiDialog header{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 14px; background:#11192e; color:#f4f6fb;
  }
  #aiClose{ background:transparent; border:0; color:#fff; font-size:22px; cursor:pointer; }
  @media (prefers-reduced-motion:no-preference){
    #aiModal{ animation:fadeIn .15s ease-out; }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
  }
</style>
